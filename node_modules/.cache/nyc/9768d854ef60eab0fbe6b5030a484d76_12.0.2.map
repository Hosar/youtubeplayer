{"version":3,"sources":["youtube.js"],"names":["config","YoutubeService","axios","console","log","countryCode","getVideosByCountry","then","trendingVideos","data","items","formatVideoItems","getDetails","params","part","chart","regionCode","maxResults","key","youtubeApi","get","trendingVideosInfo","i","length","videoInfo","id","title","snippet","thumbnail","thumbnails","high","url","publishedAt","fromNow","push","videosInfo","ctx","videosWithDetails","map","getCountsDetails","_video","Promise","resolve","reject","getVideoCounts","call","videoWithCountsInfo","Object","assign","counts","catch","video","all","videoId","res","result","viewCount","statistics","likeCount"],"mappings":"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","file":"youtube.js","sourceRoot":"/home/hosar/Projects/youtube-trends-node/Code/services","sourcesContent":["import * as config from '../config.json';\nimport moment from \"moment\";\nimport { access } from 'fs';\nimport { resolve } from 'url';\n\n\nexport class YoutubeService {\n\n  constructor(axios) {\n    this.axios = axios;\n    console.log('this.axios');\n    console.log(this.axios);\n  }\n\n  getTrendingVideos(countryCode) {    \n    return this.getVideosByCountry(countryCode)\n               .then(trendingVideos => trendingVideos.data.items)\n               .then(this.formatVideoItems)\n               .then(this.getDetails);\n  }\n\n  getVideosByCountry(countryCode){\n    const params = {\n      part: 'snippet',\n      chart: 'mostPopular',\n      regionCode: countryCode, // should be replaced with country code from countryList\n      maxResults: '24',\n      key: config.youtubeApi.key\n    };\n\n    \n    return this.axios.get('/', {params});\n  }\n\n  formatVideoItems(trendingVideos) {\n    const trendingVideosInfo = [];\n    for (let i = 0; i < trendingVideos.length; i++) {\n      const videoInfo = {\n        id: trendingVideos[i].id,\n        title: trendingVideos[i].snippet.title,\n        thumbnail: trendingVideos[i].snippet.thumbnails.high.url,\n        publishedAt: moment(trendingVideos[i].snippet.publishedAt).fromNow()\n      };\n      trendingVideosInfo.push(videoInfo);      \n    }\n    return trendingVideosInfo;\n  }\n\n  getDetails(videosInfo) {\n      const ctx = this;\n      const videosWithDetails = videosInfo.map(video => {\n        const getCountsDetails = (_video) => new Promise(function(resolve, reject) {\n          ctx.getVideoCounts.call(ctx, _video.id).then(counts => {\n            const videoWithCountsInfo = Object.assign({}, _video, counts) \n            resolve(videoWithCountsInfo)\n          }).catch(reject);          \n        })\n      \n        return getCountsDetails(video);\n      });\n\n      return Promise.all(videosWithDetails);\n  }\n\n  getVideoCounts(videoId) {\n    const params = {\n      part: 'statistics',\n      id: videoId,\n      key: config.youtubeApi.key\n    };\n\n    console.log('this.axios.....:');\n    console.log(this.axios);\n    return this.axios.get('/', {params}).then(function(res) {\n      const result = res.data;\n      const viewCount = result['items'][0].statistics.viewCount;\n      const likeCount = result['items'][0].statistics.likeCount;\n\n      return {\n        viewCount,\n        likeCount\n      };\n    });\n  }\n}\n"]}